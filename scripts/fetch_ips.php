<?php

date_default_timezone_set('Asia/Tehran');
$last_updated = date('Y-m-d H:i:s');

function read_json_list($file) {
    if (!file_exists($file)) return [];
    $json = file_get_contents($file);
    $data = json_decode($json, true);
    return is_array($data) ? $data : [];
}

// خواندن آی‌پی‌ها از فایل‌های خروجی
$ipv4 = read_json_list('list/ipv4.json');
$ipv6 = read_json_list('list/ipv6.json');

// تولید محتوای README
$readme = "# Optimized IP Addresses\n\n";
$readme .= "## Last Updated: {$last_updated}\n\n";
$readme .= "This repository provides a list of optimized IPv4 and IPv6 addresses fetched from the Hostmonit API. These addresses can be used for network optimization, proxy setup, or other connectivity purposes. The list is updated every 2 hours to ensure freshness.\n\n";

$readme .= "## IPv4\n";
foreach (array_slice($ipv4, 0, 15) as $ip) {
    $readme .= "```\n{$ip}\n```\n";
}

$readme .= "\n## IPv6\n";
foreach (array_slice($ipv6, 0, 15) as $ip) {
    $readme .= "```\n{$ip}\n```\n";
}

$readme .= "\nGenerated by scripts/fetch_ips.php\n";

// ذخیره فایل README.md با فرمت صحیح
file_put_contents("README.md", $readme);
echo "README.md updated successfully!\n";
